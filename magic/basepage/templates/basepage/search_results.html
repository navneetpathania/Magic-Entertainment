{% extends 'basepage/base.html' %}
{% load static %}
{%block style%}
<link rel="stylesheet" href="{% static 'css/content-list.css' %}">
{% endblock%}
{% block content %}
<!-- Include Bootstrap CSS -->
<h4> Result for <span class="text-info">{{search_query}}</span></h4>
<hr class="bg-white">

{% if movies %}
<h3>{{movies|length }} Movies found</h3>
<div class="wrapper">
  {% for movie in movies %}
  <div class="item ">
    <img class="account-img" src="{{ movie.poster.url }}" alt="image not found">
    <div class="songbody px-2">
      <h4>{{ movie.title }}</h4>
      <div>Release date: {{ movie.release_date }}</div>
      <div>Director: {{ movie.director }}</div>
      <h2><i class="fab fa-imdb"></i> <span class="rating"> {{ movie.rating }}</span></h2>

      {% if movie in liked %}
      <div><button class="like-button text-primary p-1" data-movie-id="{{ movie.id }}"> <i
            class="fas fa-thumbs-up total-likes "> {{movie.liked_by.all.count}}</i> </button></div>
      {% else %}
      <div><button class="like-button p-1" data-movie-id="{{ movie.id }}"> <i class="fas fa-thumbs-up total-likes ">
            {{movie.liked_by.all.count}}</i> </button></div>
      {% endif %}
      {% if movie.subscription_only %}
      <span class="premium-tag">Premium</span>
      {% if status == 'active'%}
      <form action="{% url 'history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="movie_id" value="{{movie.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
      {% else %}

      <form action="{% url 'history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="movie_id" value="{{movie.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
    </div>
  </div>
    
    {% endfor %}
</div>

{% endif %}
{% if music %}
<h3>{{music|length }} Songs found </h3>
<div class="wrapper ">

  {% for song in music %}
  <div class="item ">
    <img class="account-img" src="{{ song.album.image.url }}" alt="image not found">
    <div class="songbody px-2">
      <h4>{{ song.title }} <span class="rating">({{song.album.release_date}})</span></h4>
      <div>Album: {{ song.album.name}}</div>
      <div>Artist: {% for artist in song.artists.all %}
        {{artist}} {% endfor %}</div>
      <div>Genre: {{song.genre}}</div>
      {% if song in liked %}
      <div><button class="like-button text-primary p-1" data-song-id="{{ song.id }}"> <i
            class="fas fa-thumbs-up total-likes "> {{song.liked_by.all.count}}</i> </button></div>
      {% else %}
      <div><button class="like-button p-1" data-song-id="{{ song.id }}"> <i class="fas fa-thumbs-up total-likes ">
            {{song.liked_by.all.count}}</i> </button></div>
      {% endif %}
      {% if song.subscription_only %}
      <span class="premium-tag">Premium</span>
      {% if status == 'active'%}
      <form action="{% url 'song_history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="song_id" value="{{song.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
      {% else %}

      <form action="{% url 'song_history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="song_id" value="{{song.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
    </div>
  </div>
    {% endfor %}
</div>

{% endif %}

{% if documentaries %}
<h3> {{documentaries|length }} Documentaries found </h3>
<div class="wrapper ">

  {% for documentary in documentaries %}

  <div class="item ">
    <img class="account-img" src="{{ documentary.poster.url }}" alt="image not found">
    <div class="songbody px-2">
      <h4>{{ documentary.title }}</h4>
      <div>Release date: {{ documentary.release_date }}</div>
      <div>Director: {{ documentary.director }}</div>
      <h2><i class="fab fa-imdb"></i> <span class="rating"> {{ documentary.rating }}</span></h2>

      {% if documentary in liked %}
      <div><button class="like-button text-primary p-1" data-documentary-id="{{ documentary.id }}"> <i
            class="fas fa-thumbs-up total-likes "> {{documentary.liked_by.all.count}}</i> </button></div>
      {% else %}
      <div><button class="like-button p-1" data-documentary-id="{{ documentary.id }}"> <i
            class="fas fa-thumbs-up total-likes ">
            {{documentary.liked_by.all.count}}</i> </button></div>
      {% endif %}
      {% if documentary.subscription_only %}
      <span class="premium-tag">Premium</span>
      {% if status == 'active'%}
      <form action="{% url 'documentary_history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="documentary_id" value="{{documentary.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
      {% else %}

      <form action="{% url 'documentary_history'%}" method="post">
        {% csrf_token %}
        <input type="hidden" name="documentary_id" value="{{documentary.id}}">
        <button class="btn btn-outline-primary play-button">
          <i class="fa fa-play"></i>
        </button>
      </form>
      {% endif %}
    </div>
  </div>

  {% endfor %}
</div>
{% endif %}

{% block script%}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- <script>
  $(document).ready(function() {
   $('.like-button').off('click').on('click', function() {
     var documentaryId = $(this).data('documentary-id');
     var likeButton = $(this);
     $.ajax({
       url: "{% url 'documentary_like_dislike' %}",
       dataType: 'json',
       data: { 'documentary_id': documentaryId },
       success: function(response) {
         // update the like count
         likeButton.find('.total-likes').text(response.total_likes);
         if (response.liked) {
          likeButton.addClass('liked');
        } else {
          likeButton.removeClass('liked');
        }
         
       },
     });
   });
 });
 
 </script> -->
<script>
  $(document).ready(function(){
    $('.like-button').addClass("btn btn-outline-secondary btn-sm")
  });
 </script>
{% endblock %}


{% endblock %}


